# 비축 물량 신뢰도 추정을 위한 계층적 베이즈 분석

## 1. 프로젝트 개요

본 프로젝트는 제한된 수량의 샘플 테스트 데이터만을 사용하여, 전체 비축 물량(수천 ~ 수만 단위)의 현재 신뢰도를 통계적으로 추정하는 것을 목표로 합니다.

특히, 미래에 대한 불확실한 가정을 **'낙관적 시나리오'**와 **'보수적 시나리오'**로 나누어 모델링하고, 각 시나리오가 전체 비축 물량의 평균 신뢰도 추정치에 어떤 영향을 미치는지 비교 분석합니다.

## 2. 분석 방법론: 계층적 베이즈 모델 (Hierarchical Bayesian Model)

이 분석의 핵심은 **계층적 베이즈 모델**입니다. 이 모델은 "정보를 빌려오는(Information Borrowing)" 개념을 사용하여, 데이터가 부족한 그룹(LOT)의 정보를 데이터가 있는 그룹의 정보로부터 추론할 수 있게 해줍니다.

### 모델의 계층 구조

우리 모델은 다음과 같은 3단계 계층 구조를 가집니다.

1.  **최상위 계층 (Global Level): 전체 평균**
    *   `mu_global_logit`: 모든 생산 연도와 모든 LOT을 아우르는 전체 비축 물량의 '기본' 신뢰도 수준입니다. (로짓 스케일)

2.  **중간 계층 (Year Level): 연도별 특성**
    *   `theta_year`: 각 생산 연도(`2015`, `2016`, ...)의 평균 신뢰도입니다. 이 값은 전체 평균(`mu_global_logit`)을 중심으로 `sigma_year`(연도 간 변동성)만큼 흩어집니다.
    *   `sigma_year`: 연도별 신뢰도가 얼마나 다른지를 나타내는 파라미터입니다. 이 값이 크면 연도별 품질 차이가 크다는 의미입니다.

3.  **최하위 계층 (LOT Level): 개별 LOT 특성**
    *   `theta_lot`: 개별 LOT(`2015-LOT-01`, `2015-LOT-02`, ...)의 신뢰도입니다. 이 값은 자신이 속한 연도의 평균 신뢰도(`theta_year`)를 중심으로 `sigma_lot_effective`(LOT 간 변동성)만큼 흩어집니다.
    *   `sigma_lot_base`: 같은 연도 내에서 LOT별 신뢰도가 얼마나 다른지를 나타내는 기본 변동성입니다.

### 시나리오 분석의 핵심

두 가지 시나리오는 모델의 **사전 확률(Prior)** 설정을 다르게 하여 구현합니다.

*   **낙관적 시나리오 (Optimistic)**
    *   `inter_year_sigma` (연간 변동성 사전 확률)를 **작게** 설정합니다.
        *   의미: "생산 연도가 달라도 제품 품질은 거의 균일할 것이다."
    *   `intra_lot_sigma` (LOT간 변동성 사전 확률)를 **작게** 설정합니다.
        *   의미: "같은 해에 생산된 LOT들은 품질이 거의 비슷할 것이다."
    *   `degradation_effect_on_variance` (경년 변화 효과)를 **False**로 설정합니다.
        *   의미: "오래된 제품이라고 해서 품질 변동성이 더 커지지는 않을 것이다."

*   **보수적 시나리오 (Pessimistic)**
    *   `inter_year_sigma`를 **크게** 설정합니다.
        *   의미: "생산 연도에 따라 품질 차이가 클 수도 있다."
    *   `intra_lot_sigma`를 **크게** 설정합니다.
        *   의미: "같은 해에 생산된 LOT이라도 품질이 제각각일 수 있다."
    *   `degradation_effect_on_variance`를 **True**로 설정합니다.
        *   의미: "제품이 오래될수록 품질 변동성이 더 커질 수 있다." (`variance_degradation_rate` 파라미터 추가)

## 3. 코드 실행 및 환경 구성

이 분석은 `Miniconda`를 사용한 독립된 가상 환경에서 실행하는 것을 권장합니다.

### 3.1. 가상 환경 생성 및 활성화

```bash
# 1. 'stockpile_analysis' 이름의 가상 환경 생성 (Python 3.10)
conda create -n stockpile_analysis python=3.10

# 2. 생성한 가상 환경 활성화
conda activate stockpile_analysis
```

### 3.2. 필수 라이브러리 설치

```bash
conda install -c conda-forge pymc pandas arviz matplotlib seaborn
```

### 3.3. 스크립트 실행

스크립트 파일(`run_forest_plot_comparison_ver2.py`)이 있는 폴더로 이동한 후, 다음 명령어를 실행합니다.

```bash
python run_forest_plot_comparison_ver2.py
```

### 3.4. 실행 결과

스크립트를 실행하면 MCMC 시뮬레이션이 진행된 후, 다음과 같은 결과가 출력됩니다.

1.  **터미널 출력**: 각 시나리오별 전체 비축 물량의 90% 신뢰수준 하한치(HDI)가 텍스트로 출력됩니다.
2.  **시각화 창**:
   *   **밀도 플롯 (Density Plot)**: 두 시나리오의 '전체 비축 물량 평균 신뢰도' 분포를 비교하는 그래프가 나타납니다.
   *   **사후 분포 플롯 (Posterior Plot)**: 각 시나리오별로 모델의 주요 파라미터(`mu_global_logit`, `sigma_year` 등)가 어떤 값으로 추정되었는지 보여주는 그래프가 나타납니다.

---
*이 문서는 프로젝트의 통계적 방법론과 코드 실행 절차를 요약하여 분석의 투명성과 재현성을 높이기 위해 작성되었습니다.*

